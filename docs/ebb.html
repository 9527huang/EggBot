<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>EBB Command Set Documentation</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Eggbot</h1>
        <p>Software for the Original EggBot Kit</p>
        <p class="view"><a href="https://github.com/evil-mad/EggBot">View the Project on GitHub <small>evil-mad/EggBot</small></a></p>
        <ul>
          <li><a href="https://github.com/evil-mad/EggBot">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="eggbot" class="anchor" href="#eggbot" aria-hidden="true">
	<span aria-hidden="true" class="octicon octicon-link"></span></a>EBB (EiBotBoard) Command Set</h1>
<p>
	
This document details the serial command protocol used by the <a href="http://www.schmalzhaus.com/EBB/">EBB</a> (EiBotBoard). The EBB is an open source USB-based motor control board, designed to drive two stepper motors. The EBB may be used on its own, or found as the control board of such machines as <a href="http://egg-bot.com">The Original Egg-Bot</a>, <a href="http://watercolorbot.com">The WaterColorBot</a>, or <a href="http://axidraw.com">AxiDraw</a>.
</p>
<p />
<hr />
<p />

<H2>Contents</H2>
<ol>
	<li><a href="#apis">Serial communication and APIs</a></li>
	<li><a href="#introduction">Introduction to the EBB firmware</a></li>
	<li><a href="#version_differences">Differences between versions</a></li>
	<li><a href="#issues">Addressing issues</a></li>
	<li><a href="#additional_resources">Additional resources</a></li>
	<li><a href="#EBB_Command_Reference">Command reference</a></li>
	<ol>
		<li><a href="#syntax">Syntax and conventions</a></li>
		<li><a href="#commands">List of commands</a></li>
	</ol>
	<li><a href="#faq">FAQ</a></li>
	<li><a href="#license">License</a></li>
</ol>

<p />
<hr />
<p />


    <H2><a name="apis"></a>Serial communication: High-level interfaces and APIs</H2>

<p>The serial protocol described in this document can be used directly, for example from a serial terminal, in order to carry out simple tasks. 
	
	It can also be accessed from within any program or programming environment that is capable of communicating to a USB serial device. Using this protocol from within high high-level computer languages allows one to construct and execute complex motion. Essentially all EBB applications and interfaces use this serial protocol, at their lowest levels, in order to manage the motion control. 
</p>
<p>
	The serial protocol specifies the fundamental primitives of how the machine operates&mdash; for example moving from position (<i>a1</i>,<i>b1</i>) to position (<i>a2</i>,<i>b2</i>) in duration &Delta;<i>t</i>, with the pen-lift servo motor at position <i>z</i>. By contrast, higher level programs may perform tasks such as opening up SVG files and converting their into a set of robotic movements that can be carried out through the serial protocol.</p>
<p />

Here are some possible starting points for building higher level applications:
<UL>
<LI>The Inkscape-based drivers <a href="https://github.com/evil-mad/EggBot">for the EggBot</a>, 
<a href="https://github.com/evil-mad/wcb-ink">for the WaterColorBot</a>, and <a href="https://githukhb.com/evil-mad/axidraw">for AxiDraw</a> are written
in python, and work through use this serial protocol. The codebases from those projects are excellent resources for getting started.
</LI>
<LI>
The <a href="http://processing.org">Processing</a>-based program <a href="https://github.com/evil-mad/robopaint-rt">RoboPaint RT</a> is designed to control the 
WaterColorBot through a real-time interface. This program is written in Processing (Java), and serves as a good example of how to manage the EBB through Processing.
</LI>
<LI>
<a href="https://github.com/evil-mad/robopaint">RoboPaint</a> is a stand-alone cross-platform program to drive the WaterColorBot (as well as EggBot and AxiDraw). RoboPaint is written in javascript and (while running) provides several APIs that can be used to control machines based on the EBB:
<ul>
	<li>RoboPaint, under the hood, uses the <a href="https://github.com/techninja/cncserver/">cncserver</a> and its RESTful API to operate. It is a relatively low level interface, with similar functionality to the serial protocol, plus with a few helpful utilities. </li>
	<li>The higher-level <a href="https://github.com/evil-mad/robopaint-mode-remote/blob/master/API.md">RoboPaint remote print API</a> allows local or remote "printing" of SVG files to EBB based machines, when attached to a computer running RoboPaint.</li>
	 <li>The simplified ("GET only") <a href="https://github.com/techninja/cncserver/blob/master/scratch/SCRATCH.API.md">Scratch API</a> provides a method of controlling EBB based machines from the address bar of a web browser, or from simple programming languages that can retrieve data from an URL.</li>
	</ul></li>
<li><a href="https://github.com/techninja/cncserver/">cncserver</a> can be run on its own, from the command line, as a javascript-based RESTful API server to control EBB-based machines. (You can also run it by simply launching RoboPaint.)</li>
</ul>
	

<p />


<p />
<hr />
<p />




    <H2><a name="introduction"></a>Introduction to the EBB firmware</H2>
 <p>
	    The EBB firmware is based on the <a href="http://www.schmalzhaus.com/UBW/Doc/FirmwareDDocumentation_v145.html">UBW</a>
    firmware. The same basic command processing framework is used, so
    the same type of commands are used, and the same type of errors are
    returned. See the <a
      href="http://www.schmalzhaus.com/UBW/Doc/FirmwareDDocumentation_v145.html">UBW command
      documentation</a> for an introduction to these topics.<br>
    <br />
    This command reference applies to EiBotBoard Firmware v1.8.0 and
    above. (Any differences between firmware versions are noted below
    and in release notes.)<p />
 
 
<p />
<hr />
<p />

    <H2><a name="version_differences"></a>Differences between firmware versions</H2>
<p>
Although the EBB firmware is a continuously evolving code base, we have since version 2.0.1 taken care to avoid compatibility changes
    that would affect the most common machines using the EBB: The EggBot, WaterColorBot and (more recently,) the AxiDraw). 
    If you are using one of these machines, there is generally no particular benefit or
    compelling reason for you to update your firmware to a newer version.
    (Older machines with older firmware will continue to work just fine with that older firmware.)
 </p><p>
	That said, there have been many smaller changes in the code between the versions that
    ship preloaded on the EBB (which may be a low as v2.0.1) and the
    latest versions (2.4.x). Most of the changes have been minor bug fixes
    and new, minor functions that are helpful for less common applications.  
    If you are developing new applications with the EBB, we do encourage you to update to the newest version. If, on the other hand, you are writing new software that targets machines of various ages (for example, new EggBot software), please be aware that many of the machines out there are still using older firmware revisions. 
 </p><p>
  
  Be aware that this documentation refers not only to different versions of the EBB firmware, but also to different versions of the EBB hardware. For example, the "EM" command has different behaviors on different versions of the EBB hardware.
  
   </p>
<p />
<hr />
<p />

    <H2><a name="issues"></a>Addressing Issues</H2>
<p>
    If you discover something that does not work as
    expected in the EBB firmware, please contact us by <a href="http://shop.evilmadscientist.com/contact">e-mail</a>, in our forum, or 
    (preferably) file an issue on GitHub : <a
      href="https://github.com/evil-mad/EggBot/issues">https://github.com/evil-mad/EggBot/issues</a>.  
 </p><p>
      Please include a clear method to reproduce the issue, the expected behavior as well as the observed behavior, and the version number of the EBB firmware version that you are using.
   </p>
<p />
<hr />
<p />



    
    <H2><a name="additional_resources"></a>Additional Resources</H2>
    <ul>
      <li><a href="http://www.schmalzhaus.com/EBB/EBBConfig.html">Boot up configuration information</a></li>
      <li>Hardware documentation for the EBB can be found on the <a href="http://www.schmalzhaus.com/EBB/">main EBB page</a>.
      <li>Instructions for updating firmware can be found on the <a href="http://www.schmalzhaus.com/EBB/">main EBB page</a>.
       <li><a href="EBBReleaseNotes.html">EBB firmware release notes</a> for versions 2.0.1 up through the newest version.</li>         
          
    </ul>


<p />
<hr />
<p />




    <br>
    <H2><a name="EBB_Command_Reference"></a>EBB Command Reference<br>
    </H2>
  
    
     <H3><a name="syntax"></a>Syntax and conventions<br>
    </H3>   
    
<p>The following syntax conventions are established to assist with clarity of communication as we describe the EBB commands.
</p>
    
<h4>EBB Syntax Conventions:</h4>
<ul>
<li>Command format descriptions and examples are set in <code>code font</code>, with a shaded background.
<li>Query response format descriptions and examples are also set in the same <code>code font</code>.
<li><i>Italics</i> are used to represent variables and adjustable parameters.
<li>Square brackets (<code>[ ]</code>) are used to enclose optional items.
<li>Angle brackets (<code>&lt; &gt;</code>) are used to represent individual control characters, such as <code>&lt;CR&gt;</code> for carriage return, in command and query format descriptions.
<li>Individual control characters may also be given by their backslash-escaped representation, as in <code>\r</code> for carriage return, in the context of literal command examples.
<li>All unitalicized text and punctuation within a command description must be used literally.
</UL>

<h4>Additionally, please note that:</h4>
<ul>
<li>All commands are composed of ASCII characters
<li>All commands are case insensitive.
<li>No whitespace (including spaces, tabs, or returns) is allowed within a command.
<li>All commands must have a total length of 64 characters or fewer, including the terminating  <code>&lt;CR&gt;</code> .
</UL>
    
      <H3><a name="commands"></a>The EBB Command Set<br>
    </H3>  
    
<ul>    
<li><a href="#A">A</a> &mdash; Analog value get
<li><a href="#AC">AC</a> &mdash; Analog Configure
<li><a href="#BL">BL</a> &mdash; Enter Bootloader
<li><a href="#CN">CN</a> &mdash; Clear node count
<li><a href="#EM">EM</a> &mdash; Enable Motors
<li><a href="#ES">ES</a> &mdash; E Stop
<li><a href="#ND">ND</a> &mdash; Node Count Decrement
<li><a href="#NI">NI</a> &mdash; Node Count Increment

<li><a href="#QB">QB</a> &mdash; Query Button
<li><a href="#QC">QC</a> &mdash; Query Current
<li><a href="#QL">QL</a> &mdash; Query Layer
<li><a href="#QM">QM</a> &mdash; Query Motor
<li><a href="#QN">QN</a> &mdash; Query node count
<li><a href="#QP">QP</a> &mdash; Query Pen

<li><a href="#S2">S2</a> &mdash; General RC Servo Output
<li><a href="#SC">SC</a> &mdash; Stepper and Servo Mode Configure
<li><a href="#SE">SE</a> &mdash; Set Engraver
<li><a href="#SL">SL</a> &mdash; Set Layer
<li><a href="#SM">SM</a> &mdash; Stepper Move
<li><a href="#SN">SN</a> &mdash; Set node count 
<li><a href="#SP">SP</a> &mdash; Set Pen State
<li><a href="#TP">TP</a> &mdash; Toggle Pen 

<li><a href="#XM">XM</a> &mdash; Stepper Move, for Mixed-axis Geometries
</ul>
  
     <p />   
In addition to these commands, the following commands from the <a href="http://www.schmalzhaus.com/UBW/Doc/FirmwareDDocumentation_v145.html">UBW command set</a> can be used on the EBB as well:
R, CU, T, O, I, V, MR, MW, PO, PI, PD, PC, PG.
     
     <p />
       
<hr class="short" />
   
   <h4><a name="A"></a>"A" &mdash; Analog value get</h4>
 
	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>A&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>A,<i>channel</i>:<i>value</i>,<i>channel</i>:<i>value</i></code> .
	. . <code>&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Firmware versions:</span> v2.2.3 and newer </li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>Read all analog (ADC) input values.</p>

	<p>When one or more analog channels are enabled (see "AC" command below),
        the "A" command will cause the EBB to return a list of all
        enabled channels and their associated 10 bit values.  </p>
      <p>The list of channels and their data will always be in sorted
        order from least (channel) to greatest. Only enabled channels
        will be present in the list.</p>
      <p>The <i>value</i> returned for each enabled channel will range
        from 0 (for 0.0 V on the input) to 1023 (for 3.3 V on the input).</p>
      <p>The channel number and ADC value are both padded to 2 and 4
        characters respectively in the A response.</p>
        
      </li>
      <li><span style="font-weight: bold;">Example Return Packet:</span>
        <code>A,00:0713,02:0241,05:0089:09:1004&lt;CR&gt;</code> if channels 0, 2,
        5 and 9 are enabled.&nbsp;</li>
      <li>NOTE 1: The EBB's analog inputs are only rated for up to 3.3 V.
        Be careful not to put higher voltages on them (including 5 V)
         or you may damage the pin.</li>
      <li>NOTE 2: If you connect an ADC pin to GND (0.0 V) it will likely
        not read exactly 0. It will be a bit higher than that. (A typical value is
        0023.) This is because of the way that the analog
        input reference voltages are supplied to the microcontroller.<br>
      </li>
      <li><span style="font-weight: bold;">Version History:</span>  For firmware versions prior to v2.2.3, a different "A" command format is
      used, identical to the the UBW "A" command. 
        (See <a href="http://www.schmalzhaus.com/UBW/Doc/FirmwareDDocumentation_v145.html">UBW documentation</a>
        for details.) These commands were rewritten for v2.2.3, with the AC command
         added and the A command modified to
        return a list that includes the channel number as well as the
        ADC value for each channel. </li>
   </ul>
   
<hr class="short" />
    
    
   <h4><a name="AC"></a>"AC" &mdash; Analog Configure</h4>
 
	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>AC,<i>channel</i>,<i>enable</i>&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Firmware versions:</span> v2.2.3 and newer  </li>
	
	<li><span style="font-weight: bold;">Arguments:</span>
	<ul>
        <li><i>channel</i>: An integer in the range of 0 to 15 (inclusive). The analog input channel number that you wish to enable or disable. </li>
        <li><i>enable</i>: A value of either 1 or 0. A value of 1 will enable the channel. A value of 0 will disable the channel.</li>
	</ul></li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>Configure an analog input channel.</p>

	<p>
Use this command to turn on or turn off individual analog
        channels. Once a channel is turned on, it will begin converting
        analog values to digital values and the results of the
        conversions will be displayed in the returned value of the "A" Command. See "A" command above. 
        You can turn on and off any of
        the 16 analog channels individually on this microcontroller.
        Once a channel is turned off, it will no longer show up in the
        "A" packet returned value list.</p>
        <p>
	    The channel numbers correspond to lines ANx on the EBB schematic and
        on the datasheet of the microcontroller.
        For example, pin 11 of the PIC, which is labeled RB2 and comes
        out as the RB2 pin on the servo header, has the text
        "RB2/AN8/CTEDG1/PMA3/VMO/REFO/RP5" next to it on the CPU symbol.
        This means that this pin is internally connected to Analog Channel 8.
        See chapter 21 of the <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/39931d.pdf">PIC18F46J50
          datasheet</a> to read more about the ADC converter.</p></li></ul>
    
<hr class="short" />
    
       <h4><a name="BL"></a>"BL"  &mdash; Enter Bootloader</h4>
 
	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>BL&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.5 and newer (with changes)</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>Enter bootloader mode.</p>
	<p>
This command turns off interrupts and jumps into the
        bootloader, so that new firmware may be uploaded. This particular method of entering
        bootloader mode is unique in that no physical button presses are required.
        </p></li>
	<li><span style="font-weight: bold;">Version History:</span>  
		Added in v1.9.5. <p>
		This command will ONLY work if you
        have a EBB bootloader version later than 7/3/2010 (the version
        released on 7/3/2010 has a distinct LED blink mode - the USB LED
        stays on 3 times longer than the USR LED). With a previous
        version of the bootloader code, this command may cause the EBB
        to be come unresponsive.</p></li>
	</ul>

<hr class="short" />    

       <h4><a name="CN"></a>"CN" &mdash; Clear node count [obsolete]</h4>
      
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>CN&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> Removed, as of v1.9.5 </li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>Clear the value of the Node Counter.</p>
	<p>
See the "QN" command for a description of the node counter and its operations.
        </p></li>
	<li><span style="font-weight: bold;">Version History:</span>  
		Obsolete. <p>
		Added in v1.9.3, removed in v1.9.5</p></li>
	</ul>
     
  
 <hr class="short" />    
     
    <h4><a name="EM"></a> "EM"  &mdash; Enable Motors (for EBB v1.1)</h4>
 
  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>EM,<i>EnableAxis1</i>[,<i>EnableAxis2</i>]&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> All </li>

 	<li><span style="font-weight: bold;">Arguments:</span> For each stepper motor (<i>EnableAxis1</i> or <i>EnableAxis2</i>), an integer in the range of 0 through 4, inclusive. The allowed values and their effects are as follows:
        <ul>
          <li>0: Disable that axis </li>
          <li>1: Enable in 1/8th step mode (default)</li>
          <li>2: Enable in 1/4 step mode</li>
          <li>3: Enable in 1/2 step mode</li>
          <li>4: Enable in full step mode<br>
          </li>
        </ul>
	</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>Enable or disable stepper motors and set step size.</p>
	<p>
	Each stepper motor axis may be enabled (energized) or disabled. When disabled, the driver will stop sending current to the motor, so the motor will "freewheel" &mdash; it will not be actively driven, but instead will present little resistance to being turned by external torques.</p>
	<p>
	When enabled, the stepper motor axes may be configured to be in whole, half, quarter, or eighth step sizes. In a motor with a native resolution of 200 steps per revolution, these settings would produce effective stepping resolutions of 200, 400, 800, and 1600 steps per revolution, respectively. Using fine sub-steps ("microstepping") gives higher resolution at the cost of decreasing step size reproducibility. </p>
	<p>
	Note that this version of the command is only for EBB hardware v1.1. </p>
	</li>
      <li><span style="font-weight: bold;">Example:</span> <code>EM,1,0\r</code> Enable Axis 1 in 1/8th step mode, and disable Axis 2</li>
      <li><span style="font-weight: bold;">Example:</span> <code>EM,2\r</code> Enable both axes in 1/4th step mode ?</li> (Brian-- please check.)
    </ul>
         
      
<hr class="short" />    

    <h4><a name="EM"></a> "EM"  &mdash; Enable Motors (for EBB v1.2 and newer)</h4>
 
  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>EM,<i>Enable1</i>[,<i>Enable2</i>]&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> All </li>

 	<li><span style="font-weight: bold;">Arguments:</span> 
 	<p>For each stepper motor (<i>Enable1</i> or <i>Enable2</i>), an integer in the range of 0 through 5, inclusive. 
 	An <i>Enable</i> value of 0 will disable the motor, while a nonzero value will enable the motor.</p>
 	<p>
  	The allowed values of <i>Enable1</i> are as follows:</p>
        <ul>
          <li>0: Disable motor 1 </li>
          <li>1: Enable motor 1, set both motors to 1/16th step mode (default resolution upon reset)</li>
          <li>2: Enable motor 1, set both motors to  1/8th step mode</li>
          <li>3: Enable motor 1, set both motors to  1/4 step mode</li>
          <li>4: Enable motor 1, set both motors to  1/2 step mode</li>
          <li>5: Enable motor 1, set both motors to  full step mode<br>
          </li>
        </ul>	
 	<p /><p>The allowed values of <i>Enable2</i> are as follows:</p>
        <ul>
          <li>0: Disable motor 2</li>
          <li>1 through 5: Enable motor 2 (at the resolution of motor 1)</li>
          </li>
        </ul>
	</li>
	<li><span style="font-weight: bold;">Description:</span>
	<p> Enable or disable stepper motors and set step size.</p>
	<p>
	Each stepper motor axis may be independently enabled (energized) or disabled. When disabled, the driver will stop sending current to the motor, so the motor will "freewheel" &mdash; it will not be actively driven, but instead will present little resistance to being turned by external torques.
</p>
	<p>
	When enabled, the stepper motor axes may be configured to be in whole, half, quarter, eighth, or sixteenth step sizes. In a motor with a native resolution of 200 steps per revolution, these settings would produce effective stepping resolutions of 200, 400, 800, 1600, and 3200 steps per revolution, respectively. Using fine sub-steps ("microstepping") gives higher resolution at the cost of decreasing step size reproducibility. Note that the microstep mode is set for both motors simultaneously, using the parameter value of <i>Enable1</i>. 
</p>
	<p>
	Note that this version of the command is only for EBB hardware v1.2 and newer.</p>
	</li>
      <li><span style="font-weight: bold;">Example:</span> <code>EM,1,0\r</code> Enable motor 1, and disable motor 2</li>
      <li><span style="font-weight: bold;">Example:</span> <code>EM,2\r</code> Set both axes to 1/8th step mode and enable motor 1.</li>
      <li><span style="font-weight: bold;">Example:</span> <code>EM,3,3\r</code> Set both axes to 1/4 step mode and enable both motors.</li>
      <li><span style="font-weight: bold;">Example:</span> <code>EM,0,1\r</code> Enable motor 2, and disable motor 1.</li>
    <li><span style="font-weight: bold;">Example:</span> <code>EM,0,0\r</code> Disable both motors (which will freewheel)</li>
    </ul>
      
      
<hr class="short" />    


<h4><a name="ES"></a>"ES"  &mdash; E Stop</h4>

<ul>
<li><span style="font-weight: bold;">Command:</span> <code>ES&lt;CR&gt;</code></li>
<li><span style="font-weight: bold;">Response:</span><br />
	<code><i>interrupted</i>,<i>fifo_steps1</i>,<i>fifo_steps2</i>,<i>steps_rem1</i>,<i>steps_rem2</i>&lt;CR&gt;OK&lt;CR&gt;</code>
</li>
<li><span style="font-weight: bold;">Firmware versions:</span> v2.2.7 and newer (with changes)</li>
	<li><span style="font-weight: bold;">Description:</span>
		<p> Use this command to abort any in-progress motor move (SM) Command. This command will also delete any motor move command
	        (SM) from the FIFO. It will immediately stop the motors, but
	        leave them energized. </p>
	    <p>Returned values:</p>
		    <ul>
				<li><i>interrupted</i>: 0 if no FIFO or in-progress move
				commands were interrupted, 1 if a motor move command was in progress or in the FIFO</li>
				<li><i>fifo_steps1</i> and <i>fifo_steps1</i>: 24 bit unsigned
				integers with the number of steps 
				in any SM command sitting in the fifo for axis1 and axis2.</li>
				<li><i>steps_rem1</i> and <i>steps_rem2</i>: 24 bit
				unsigned integers with the number of steps left in the currently executing SM command (if any) for 
				axis1 and axis2.</li>
		    </ul></li>
	          
	  <li><span style="font-weight: bold;">Example Return Packet:</span>
        <code>0,0,0,0,0&lt;CR&gt;OK&lt;CR&gt;</code> Indicates that no SM command was executing at the
	          time, and no SM command was in the FIFO.</li>
	  <li><span style="font-weight: bold;">Example Return Packet:</span>
        <code>1,50,1200,18634,9848&lt;CR&gt;OK&lt;CR&gt;</code> Indicates that a command was interrupted, and that the FIFO had steps of 50 and 1200 steps queued to execute next (in axes 1 and 2), as well as 18634 and 9848 steps remaining to move (in axes 1 and 1) on the current move.</li>
	   <li><span style="font-weight: bold;">Version History:</span>  
		Added in v2.2.7 <p>
		Prior to v2.2.9, this command will return a "1" if it had to stop an
        in-progress move command, or if it had to delete a move command
        from the FIFO. This could indicate that some steps might be
        lost, since the host application may think that moves have already
        completed, when in fact they were aborted partway through. It will return a "0" if no motor move commands were deleted
        or aborted.</p>
        
        	    <p>Returned values:</p>
		    <ul>
				<li><code>1&lt;CR&gt;OK&lt;CR&gt;</code>: If an in-progress move
				commands was interrupted or removed from the FIFO</li>
				<li><code>0&lt;CR&gt;OK&lt;CR&gt;</code>: If no in-progress move
				commands was interrupted or removed from the FIFO</li>
		    </ul>
   	</li>
</ul>
		
		
	
 <hr class="short" />    

       <h4><a name="ND"></a>"ND" &mdash; Node Count Decrement</h4>
      
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>ND&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.5 and newer</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>This command decrements the 32 bit Node Counter by 1.</p>
	<p>
See the "<a href="#QN">QN</a>" command for a description of the node counter and its operations.
        </p></li>
	<li><span style="font-weight: bold;">Version History:</span> Added in v1.9.5</li>
	</ul>
     
     	
		
<hr class="short" />    
 
 
       <h4><a name="NI"></a>"NI" &mdash; Node Count Increment</h4>
      
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>NI&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.5 and newer</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>This command increments the 32 bit Node Counter by 1.</p>
	<p>
See the "<a href="#QN">QN</a>" command for a description of the node counter and its operations.
        </p></li>
	<li><span style="font-weight: bold;">Version History:</span> Added in v1.9.5</li>
	</ul>
     
 
 
 

 
 <hr class="short" />    

       <h4><a name="QB"></a>"QB" &mdash; Query Button</h4>
      
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>QB&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code><i>state</i>&lt;CR&gt;OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.2 and newer</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>This command asks the EBB if the PRG button has been
        pressed since the last QB query or not.</p>
        <p> The returned value <i>state</i> is 1 if the
        PRG button has been pressed since the last QB query, and 0 otherwise.</p>
        
        </li>
	<li><span style="font-weight: bold;">Version History:</span> Added in v1.9.2</li>
	</ul>
     
     
 <hr class="short" />    
	   
	<h4><a name="QC"></a>"QC" &mdash; Query Current</h4>
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>QC&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code><i>RA0_VOLTAGE</i>,<i>V+_VOLTAGE</i>&lt;CR&gt;OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v2.2.3 and newer</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p> This command reads two analog voltages and returns their raw
        10 bit values. You can use this to read the current setpoint for the stepper motor, 
        and to read the input power that the board is receiving.

        </p>
<p> The two returned values are:	</p>
    <ul>
      <li><i>RA0_VOLTAGE</i>, the voltage on the REF_RA0 net. It is
        expressed as a zero-padded 4-digit 10 bit number where 0 = 0.0V and 1023 = 3.3V
        <p />
        <p> This value yields the
    voltage level at the REF_RA0 input to the stepper driver
    chip. This is the control voltage that sets the maximum instantaneous (not average) current that the driver chips
    allow into the motor coils.</p>
    <p> The maximum current is given approximately by <i>I_max</i> = <i>RA0_VOLTAGE</i>/1.76.  Thus,
    a voltage of 3 V at REF_RA0 would correspond to a maximum motor current of about 1.7 A.
    </p>
    </li>
      <li><i>V+_VOLTAGE</i> is the voltage on the V+ net, scaled by a voltage divider. It is
        expressed as a zero-padded 4-digit 10 bit number where 0 = 0.0V and 1023 = 3.3V
           <p />    
    <p>  
    This value yields the voltage level at on the EBB's V+ power net, which is the "motor" power coming into the board, as measured after the first input protection diode.
    </p>
    <p>  The value of <i>V+_VOLTAGE</i> as read on the ADC pin is scaled so that it does not exceed the 3.3 V maximum analog input level for the
    MCU. The scaling is performed by a voltage divider (comprised of R13 and R18 on the EBB), which gives a scaling factor of (1/11) on EBB boards v2.2 and earlier, and a scaling factor of (1/9.2) on EBB boards v2.3 and newer. As there is tolerance on the resistors, these scaling factors should be considered to be only approximate.</p>
    <p>If one also wishes to compare the to the voltage read to that at the power input, it is necessary to also account
    for both the forward voltage across the input diode: the "diode drop" across the input diode is about 0.3 V at the current levels typically encountered.     </p>
     
     
    <p>The value of <i>V+_VOLTAGE</i> may be very useful in determining whether or not the EBB is plugged into power. One might also compare the value of this voltage with and without the motors enabled, in order to monitor and detect if the power supply voltage should droop due to load on the motors. </p>
      </li>
     </ul>
     </li>
    
   
     <li><span style="font-weight: bold;">Example Return Packet:</span>
        <code>0394,0300&lt;CR&gt;OK&lt;CR&gt;</code>
        <p>This query has returned values of 394 for RA0_VOLTAGE and 300 for V+_VOLTAGE. </p>
        <p>
        The first returned value, 0394, indicates a voltage of 1.27 V at REF_RA0. This indicates that the maximum motor current is currently set to 0.72 A. </p>
        <p>
	      The second returned value, 0300, indicates a voltage of 0.96 V at the V+ ADC input. Scaling by 9.2 (for the voltage divider on an EBB v2.3) and adding 0.3 V (for the diode drop), this indicates that the "actual" input voltage is about 9.1 V. 
        </p>
	        </li>   
  	<li><span style="font-weight: bold;">Version History:</span>
  	<p>This command was originally introduced in
    v2.0.0, but should not be considered functional until version 2.2.3.</p>
    <p>Note also that this command only works properly on EBB hardware
    v1.3 and above. (White EBBs from Evil Mad Scientist are v2.0 or newer, and EBBs
    from SparkFun are v2.0 and above.)</p>
    
    
    </li>
	</ul>  
   
   
     
 <hr class="short" />    
 
    
	<h4><a name="QL"></a>"QL" &mdash; Query Layer</h4>
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>QL&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code><i>CurrentLayerValue</i>&lt;CR&gt;OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.2 and newer</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>This command asks the EBB to report back the current value of
        the Layer variable. This variable is set with the <a href="#SL">SL</a> command, as
        a single unsigned byte.
	</p></li>
	     <li><span style="font-weight: bold;">Example:</span> <code>QL\r</code>
	     <li><span style="font-weight: bold;">Example Return Packet:</span> <code>4&lt;CR&gt;OK&lt;CR&gt;</code>

	
   	<li><span style="font-weight: bold;">Version History:</span> Added in v1.9.2
    
    
    </li>
	</ul>  
     
       
 <hr class="short" />    
   
   	<h4><a name="QM"></a>"QM" &mdash; Query Motor</h4>
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>QM&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>QM,<i>CommandStatus</i>,<i>Motor1Status</i>,<i>Motor2Status</i>&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v2.2.6 and newer</li>
	<li><span style="font-weight: bold;">Description:</span> 
		<p>Use this command to see what the EBB is currently doing. It
        will return the current state of the 'motion system' and each
        motor's current state.</p>
        <ul>
	        <li><i>CommandStatus</i> is nonzero if any "motion commands"
	        are presently executing, and zero otherwise. </li>
        <li><i>Motor1Status</i> is 1 if motor 1 is currently moving, and 0 if it is idle.</li>
        <li><i>Motor2Status</i> is 1 if motor 2 is currently moving, and 0 if it is idle.</li>   
      </ul>
<p />
      <p>The definition of a "motion command" is any command that has a
        time associated with it. For example, all SM commands. Also, any Command (like S2, SP, or TP) that uses a <i>delay</i> or
        <i>duration</i> parameter. All of these commands cause the
        motion processor to perform an action that takes some length of time,
        which then prevents later motion commands from running until
        they have finished.</p>
      <p>It is important to note that with all existing EBB
        firmware versions, only a very limited number of 
        "motion commands" can be executing or queued simultaneously.
        In fact, there can only be three. One (the first one) will be
        actually executing. Another one (the second) will be stored in
        the 1-deep FIFO buffer that sits between the USB command processor and
        the motion engine that executes motion commands. Then the last
        one (the third) will be stuck in the USB command buffer, waiting
        for the 1-deep FIFO to be emptied before it can be processed.
        Once these three motion commands are "filled," the whole USB Command processor will block (i.e. lock up) until the FIFO is
        cleared, and the third motion command can be processed and put
        into the FIFO. This means that no USB commands can be processed
        by the EBB once the third motion command gets "stuck" in the USB Command processor. 
        Using the QM command can help prevent this
        situation by allowing the PC to know when there are no more
        motion commands to be executed, and so can send the next one on.<br>
      </li>
   	<li><span style="font-weight: bold;">Version History:</span> Added in v2.2.6
    </ul>

       
 <hr class="short" />    
        
   	<h4><a name="QP"></a>"QP" &mdash; Query Pen</h4>
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>QP&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code><i>PenStatus</i>&lt;CR&gt;OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9 and newer</li>
	<li><span style="font-weight: bold;">Description:</span> 
		<p>This command queries the EBB what state the pen is in. It
        will return <i>PenStatus</i> of 1 if the pen is up and 0 if the pen is down. If a
        pen up/down command is pending in the FIFO, it will only report
        the new state of the pen after the pen move has been started.</p>

      </li>
 	     <li><span style="font-weight: bold;">Example:</span> <code>QP\r</code>
	     <li><span style="font-weight: bold;">Example Return Packet:</span> <code>1&lt;CR&gt;OK&lt;CR&gt;</code>
 
   	<li><span style="font-weight: bold;">Version History:</span> Added in v1.9
    </ul>


<hr class="short" />    
    <h4><a name="SC"></a> "SC" &mdash; Stepper and Servo Mode Configure</h4>

  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>SC,<i>value1</i>,<i>value2</i>&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> All </li>

 	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>value1</i> is an integer in the range from 0 to 255, which specifies the parameter that you are adjusting.</li>
        <li><i>value2</i> is an integer in the range from 0 to 65535. It specifies the value of the parameter given by <i>value1</i>. <br>
         <li>See the list of these parameters (<i>value1</i>) and allowed values (<i>value2</i>), below.
        </li>
      </ul>
 	<li><span style="font-weight: bold;">Description:</span>
 	
 	<p>This command allows you to configure the motor control modes that the EBB uses, including parameters of the servo or 
 	solenoid motor used for raising and lowering the pen, and how the stepper motor driver signals are directed.</p>
 	<p>The set of parameters and their allowed values is as follows:</p></li>
      <ul>
	      <li><code>SC,1,<i>value2</i></code> Pen lift mechanism. <i>value2</i> may be 0, 1 or 2. Early EggBot models used a small solenoid, driven from an output signal on pin RB4. 
	      <UL>
	        <li><code>SC,1,0</code> Enable only the solenoid output (RB4) for pen up/down movement.</li>
	        <li><code>SC,1,1</code> Enable only the RC servo output (RB1) for pen up/down movement.</li>
	        <li><code>SC,1,2</code> Enable both the solenoid (RB4) and RC servo (RB1) outputs for
	          pen up/down movement (default)</li>
	      </UL>
	      </li>
 	      <li><code>SC,2,<i>value2</i></code> Stepper signal control. <i>value2</i> may be 0, 1 or 2. 
	      <UL>
         
	        <li><code>SC,2,0</code> Use microcontroller to control on-board stepper driver chips
	          (default)</li>
	        <li><code>SC,2,1</code>  Disconnect microcontroller from the
	        on-board stepper motor drivers, to drive external step/direction motor drives. In this mode, you can use the
	        microcontroller to control external step/direction drivers
	          based on the following pin assignments:
	        <ul>
		          <li>ENABLE1: RD1</li>
		          <li>ENABLE2: RA1</li>
		          <li>STEP1: RC6</li>
		          <li>DIR1: RC2</li>
		          <li>STEP2: RA5</li>
		          <li>DIR2: RA2</li>
	        </ul>Note also that in this mode, you can drive the
			step/direction/enable lines of the on board stepper motor drivers from the
			pins of J5 and J4 (all are broken out; see schematic).</li>

			
	        <li><code>SC,2,2</code> Disconnect microcontroller from both the
	        built-in motor drivers and
	          external pins. All step/dir/enable pins on the PIC are set to
	          inputs. This allows you to control the on-board
	          stepper motor driver chips externally with your own
	          step/dir/enable signals. Use the pins listed in the schematic
	          from J5 and J4. 
	        </li>
	      </UL>
	      </li>

        <li><code>SC,4,<i>servo_min</i></code> Set the minimum value for the
          RC servo output position. <i>servo_min</i> may be in the range 1 to 65535, in units of 83 ns intervals. 
          This sets the "Pen Up" position. <br />Default: 12000 (1.0 ms) on reset. </li>

        <li><code>SC,5,<i>servo_max</i></code> Set the maximum value for the
          RC servo output position. <i>servo_max</i> may be in the range 1 to 65535, in units of 83 ns intervals. 
          This sets the "Pen Down" position. 
          <br />Default: 16000 (1.3 ms) on reset.</li>          
          
         <li><code>SC,8,<i>maximum_S2_channels</i></code> Sets the number of
          channels, each of <i>S2_channel_duration_ms</i> before
          cycling back to channel 1 for S2 command. Values from 1 to 24
          are valid for <i>maximum_S2_channels</i>.
          <br />Default: 8 on reset.
        </li>
        <li><code>SC,9,<i>S2_channel_duration_ms</i></code> Set the number of
          milliseconds before firing the next enabled channel for the S2
          command. [Brian: what values are allowed?]
          <br />Default: 3 ms on reset.
        </li>
        <li><code>SC,10,<i>servo_rate</i></code> Set rate of change of the servo position, 
        for both raising and lowering movements.
        
        Same as <i>rate</i> parameter in S2 command.
        </li>
        <li><code>SC,11,<i>servo_rate_up</i></code> Set the rate of change of the
          servo when going up. Same as <i>rate</i>
          parameter in S2 command. </li>
        <li><code>SC,12,<i>servo_rate_down</i></code> Set the rate of change of
          the servo when going down. Same as
          <i>rate</i> parameter in S2 command.</li>
        <li><code>SC,13,<i>use_alt_pause</i></code> - turns on (1) or off (0)
          alternate pause button function on RB0. On by default. For
          EBB v1.1 boards, it uses RB2 instead.</li>
      </ul>
      <li><span style="font-weight: bold;">Example:</span> <code>SC,4,8000\r</code>  Set the pen-up position to give a servo output of 8000, about 0.66 ms.</li> 
      <li><span style="font-weight: bold;">Example:</span> <code>SC,1,1\r</code>  Enable only the RC servo for pen lift; disable solenoid control output.</li> 
 	<li><span style="font-weight: bold;">Version History:</span>  
 		<ul>
		<li>Mode <code>SC,11,<i>servo_rate_up</i></code> added in v1.9.2
		<li>Mode <code>SC,12,<i>servo_rate_down</i></code> added in v1.9.2
		<li>Mode <code>SC,13,<i>use_alt_pause</i></code> added in v2.0
		<li>Mode <code>SC,8,<i>maximum_S2_channels</i></code> added in v2.1.1</li>
		<li>Mode <code>SC,9,<i>S2_channel_duration_ms</i></code> added in v2.1.1</li>
		<li>Mode <code>SC,2,2</code> added in v2.2.2. </li>
		</li>
 		</ul>
	</ul>
 

<hr class="short" />    


    <h4><a name="SE"></a> "SE" &mdash; Set Engraver</h4>

  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>SE,<i>state</i>[,<i>power</i>[,<i>use_motion_queue</i>]]&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v2.1.0 and newer (with changes) </li>

 	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>state</i> may be either 0 to disable or 1 to enable the engraver output.</li>
        <li><i>power</i> is an optional argument, with allowed values of integers in the range 0 to 1023.</li>
        <li><i>use_motion_queue</i> is an optional argument, with allowed values of 0 or 1.</li>
        
      </ul>
 	<li><span style="font-weight: bold;">Description:</span>
 	 <p>This command is used to enable and disable the engraver PWM
        output on RB3 (called B3 on the board), and also set its output
        power. Use SE,0 to disable this feature.</p>
        <p>
The <i>power</i> argument represents the
        relative power (percent duty cycle of the PWM signal), where 0 is off
        and 1023 is full on. If this optional argument is not included, then the power will be set at 50&percnt; duty cycle.
	       </p>
        <p> 
         If <i>use_motion_queue</i> has the value of 1, then this SE command will be added to the motion queue just like SM and SP commands, and thus will be executed when the previous motion commands have finished. Note that if you need to use this argument, the <i>power</i> argument is not optional. If <i>use_motion_queue</i> has value 0 (or if it is omitted) the command is executed immediately, and is not added to the queue.
        </p>
 	<p>
 	</p>
 	</li> 	
	 	
	 	      <li><span style="font-weight: bold;">Example:</span> <code>SE,1,1023\r</code> Turns on the engraver output with maximum power</li>
	 	      <li><span style="font-weight: bold;">Example:</span> <code>SE,0\r</code> Turns off the engraver output</li>
	 	      <li><span style="font-weight: bold;">Example:</span> <code>SE,0,0,1\r</code> Adds a command to the motion queue, that (when executed) turns off the engraver output. [Brian, please double check]</li>

	 	
	  	<li><span style="font-weight: bold;">Version History:</span>  
		<ul>
			<li>Added in v2.1.0</li>
			<li>Versions prior to v2.2.2 do not properly set power, and instead use fixed 50&percnt; PWM.</li>
			<li>Version 2.4.1 adds the option to use the motion queue. Versions prior to this do not have this option. The proper command format for earlier versions is: <code>SE,<i>state</i>[,<i>power</i>]&lt;CR&gt;</code>
			
			</li>
		</ul>
	</ul>	
	 	
 
<hr class="short" />    

 


    <h4><a name="SL"></a> "SL" &mdash; Set Layer</h4>

  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>SL,<i>NewLayerValue</i>&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.2 and newer</li>
	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>NewLayerValue</i> is an integer between 0 and 127.</li>
      </ul>

	<li><span style="font-weight: bold;">Description:</span> 
		<p>
			This command sets the value of the Layer variable, which can be read by the <a href="#QL">QL</a> query.
      This variable is a single unsigned byte, and is available for the user to store a single variable as needed.
		</p>
	</li>

	<li><span style="font-weight: bold;">Example:</span> <code>SL,4\r</code> Set the Layer variable to 4.</li>
	<li><span style="font-weight: bold;">Example:</span> <code>SL,125\r</code> Set the Layer variable to 125.</li>

	<li><span style="font-weight: bold;">Version History:</span>  Added in v1.9.2</li>

	</ul>	

 
<hr class="short" />    

    <h4><a name="SM"></a> "SM" &mdash; Stepper Move</h4>

  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>SM,<i>duration</i>,<i>axis1</i>[,<i>axis2</i>]&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> all (with changes)</li>
	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>duration</i> is an integer in the range from 1 to 1677215, giving time in milliseconds.</li>
        <li><i>axis1</i> and <i>axis2</i> are integers, each in the range from -1677215 to 1677215, giving movement distance in steps.</li>
      </ul>

	<li><span style="font-weight: bold;">Description:</span> 
		<p>
			Use this command to make the motors draw a straight line at
        constant velocity, or to add a delay to the motion queue.
        </p> <p>
	        If both <i>axis1</i> and <i>axis2</i> are zero, then a
          delay of <i>duration</i> ms is executed. <i>axis2</i>
          is an optional value, and if it is not included in the
          command, zero steps are assumed for axis 2.
        </p> <p>The sign of <i>axis1</i> and <i>axis2</i> represent the
          direction each motor should turn.
          		</p> <p>
			The minimum speed at which the EBB can generate steps for each
        motor is 1.31 steps/second. The maximum speed is
        25,000 steps/second. If the XM command finds that this speed range
        will be violated on either axis, it will output an error message
        declaring such and it will not complete the move. Note that the
        range is checked on Axis1 and Axis2, NOT on AxisA and AxisB.
        </p> <p>
	        Note that internally the EBB generates an ISR at the 25 kHz
        rate. Each time the ISR fires, the EBB determines if a step
        needs to be taken for a given axis or not. The practical result
        of this is that all steps will be 'quantized' to the 25 kHz
        (40 &mu;s) time intervals, and thus as the step rate gets close to
        25 kHz the 'correct' time between steps will not be generated,
        but instead each step will land on a 40 &mu;s tick in time. In
        almost all cases normally used by the EBB, this doesn't make any
        difference because the overall proper length for the entire move
        will be correct.
        </p> <p>
	        A value of 0 for <i>duration</i> is invalid and will be
        rejected. </p>
		
	</li>

	<li><span style="font-weight: bold;">Example:</span>  <code>SM,1000,250,-766\r</code> Move axis1 by 250 steps and axis2 by -766 steps, in 1000 ms of duration.</li>

	<li><span style="font-weight: bold;">Version History:</span>
	<ul>
	<li>In versions prior to 2.2.1, the <i>duration</i>
	parameter had a issue where values over 2621 would produce
	incorrect delays (when <i>axis1</i> and <i>axis2</i> are 0).
	</li>		
	<li>For versions prior to v2.2.5, <i>duration</i> must be a value in the range of 1 to 65,535, and the 
	<i>axis1</i> and <i>axis2</i> values must be in the range -32,767 to +32,767.
	</li>
	<li>
	As of version 2.2.5, the <i>duration</i>, <i>axis1</i>,
	and <i>axis2</i> parameters for this command are full 24 bit
	numbers. <i>duration</i> is an unsigned 24-bit value,
	while <i>axis1</i> and <i>axis2</i> are signed. This allows
	for very long stepper moves.</li>
	<li>As of version 2.2.8, the error messages for this command
	have been corrected. If an input parameter is too large
	(&gt;1677215) or a step rate is too fast (&gt;25 k steps/s) or
	too slow (&lt;1.31 steps/s) a proper error will be printed
	back to the host. 
	</li>
	</ul>
	</li>

	</ul>	

      
<hr class="short" />    

    	   
       <h4><a name="SN"></a>"SN" &mdash; Set node count </h4>
      
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>SN,<i>value</i>&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.5 and newer</li>
	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>value</i> is an unsigned long integer.</li>
      </ul>

	<li><span style="font-weight: bold;">Description:</span> 
	<p>This command sets the Node Counter to <i>value</i>.
	</p>
	<p>
See the "QN" command for a description of the node counter and its operations.
        </p></li>
        
    	<li><span style="font-weight: bold;">Example:</span>  <code>SN,123456789\r</code> Set node counter to 123456789.</li>    
        
	<li><span style="font-weight: bold;">Version History:</span>  Added in v1.9.5</li>
	</ul>    

<hr class="short" />    
   
       <h4><a name="SP"></a>"SP" &mdash; Set Pen State </h4>
      
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>SP,<i>value</i>[,<i>duration</i>[,<i>portBpin</i>]]&lt;CR&gt;</code></li>
	-- Brian: Please check that this interpretation of which commands are optional is correct.
	
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> all (with changes)</li>
	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>value</i> is either 0 or 1, indicating to raise or lower the pen.</li>
		<li><i>duration</i> (optional) is an integer from 1 to 65535, which gives a delay in milliseconds. </li>
		<li><i>portBpin</i> (optional) is an integer from 0 through 7. </li>
      </ul>


	<li><span style="font-weight: bold;">Description:</span> 
	<p>
		This command instructs the pen to go up or down.
	</p>	

		<ul>
	 <li>When a <i>value</i> of 1 is used, the servo will be moved to
        the <i>servo_min</i> value (as set by the "SC,4" command).</li>
      <li>When a <i>value</i> of 0 is used, the servo will be moved to
        the <i>servo_max</i> value (as set by the "SC,5" command</li>
        below).</li>
        </ul>
<p>
	  Note that conventionally, we have used the
        <i>servo_min</i> ("SC,4") value as the 'Pen up position', and
        the <i>servo_max</i> ("SC,5") value as the 'Pen down position'.
</p><p>
	
		The <i>duration</i> argument is in milliseconds. It represents the total length of time between
          when the pen move is started, and when the next command will
          be executed. Note that this is not related to
          how fast the pen moves, which is set with the <a href="#SC">SC</a> command. 
          Rather, it is an intentional delay of a given
          <i>duration</i>, to force the EBB not to execute
          the next command (often an <a href="#SM">SM</a>) for some length of time,
          which allows the pen move to complete
          and possibly some extra settling time before moving the other motors. 
</p><p>
		          If no <i>duration</i> argument is specified, a value of 0 milliseconds is used internally.
</p><p>
	    
        The optional <i>portBpin</i> argument allows one to specify which portB pin of the MCU the output will use.
        If none is specified, pin 1 (the default) will be used.
 </p><p>             
      	<b>Default positions:</b>The default position for the RC servo output (RB1) on reset is
        the 'Pen up position' (<i>servo_min</i>), and at boot
        <i>servo_min</i> is set to 12000 which results in a pulse width
        of 1.0 ms on boot. <i>servo_max</i> is set to 16000 on boot, so
        the down position will be 1.3 ms unless changed with the "SC,5" Command.
</p><p>	
		<b>Digital outputs:</b> On older EBB hardware versions 1.1, 1.2 and 1.3, this command
		will make the solenoid output turn on and
        off. On all EBB versions it will also make the RC servo output
        on RB1 move to the up or down position. Also, by default, it
        will turn on RB4 or turn off RB4 as a simple digital output, so
        that you could use this to trigger a laser for example.
	</p>
</li>
        
    	<li><span style="font-weight: bold;">Example:</span>  <code>SP,1\r</code> Move pen-lift servo motor to <i>servo_min</i> position.</li>    
        
	<li><span style="font-weight: bold;">Version History:</span>
	<ul>
		<li>The <i>portBpin</i> argument was added in firmware v2.1.1. 
		
		Versions prior to this do not have this option. The proper command format for earlier versions is: 
		<code>SP,<i>value</i>[,<i>duration</i>]&lt;CR&gt;</code> </li>
		
		
	<li> In versions prior to 2.2.4, the
        <i>duration</i> parameter had two bugs. One was that the units
        for <i>duration</i> were 40 &mu;s (instead of the correct 1 ms). The
        second was that the change of state of the servo would happen
        AFTER the delay had elapsed. The servo move and the
        <i>duration</i> delay are both started simultaneously now.
	</li>
	</ul>
	
	</li>
	</ul>    
   
  
  <hr class="short" />    

  
  
    <h4><a name="S2"></a> "S2"  &mdash; General RC Servo Output (versions prior to v2.2.0)</h4>
 
  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>S2,<i>channel</i>,<i>position</i>,<i>output_pin</i>[,<i>rate</i>]&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Command:</span> <code>
	S2,0&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Firmware versions:</span> Prior to v2.2.0 </li>
	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>channel</i>, a number in the range 0 to 8.
        
        <p />A value of 1 through 7 chooses a software-defined channel.
        <p />A value of 0 disables all S2 outputs.
        
        </li>
		<li><i>position</i>, a number in the range 0 to 32,000. 
		<p />The "on time" of the signal, in units of
		1/12,000,000th of a second (about 83 &mu;s).
		</li>
		<li><i>output_pin</i>, a number in the range 0 to 24.
		<p />
		The physical RPx pin number to assign this channel to.
		
		</li>
		<li><i>rate</i> (optional), a number in the range 0 to 65535.
		<p />
		The rate at which to change to the new setting.
		</li> </ul>

	</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>
		This command allows
        you to control the RC servo output system on the EBB, to configures a generic RC servo output.
         
  	</p><p>   
	  	<b>Servo channels and time slices:</b> 
 
        There are eight
        software-defined RC
        servo 'channels', which have no physical meaning other than we
        can (by default) output up to 8 separate signals at once.  The available channels are numbered 1 though 8. Channel 1 is normally used as the "pen lift" servo motor, controlled through the SP and TP commands.
        
  	</p><p>  
        (A selection of <i>channel</i> equal to 0 is a special command, used to disable all S2 functionality.) 
        
  	</p><p>   
        Many I/O
        pins on the MCU have RPx numbers (please refer to the schematic), and you can output
        RC servo pulses on up to 8 of these RPx pins. You can assign any channel to any RPx pin. 

        
          	</p><p>   
        The RC servo system will cycle through each of the 8
        channels. Each gets a 3 ms "slice" of time, thus giving a 24 ms repeat
        period for the full RC system.
        
        
  	</p><p>   
        
        If the current channel is
        enabled, then at the beginning of its 3 ms time slot, it's RPx
        pin is set high. Then, <i>position</i> time later, the RPx pin
        is set low. This time is controlled by hardware (the
        ECCP2 in the CPU) so there is very little jitter in the pulse durations.
        <i>position</i> is in units of 1/12,000 of a second, so 32,000
        for <i>position</i> would be about 2.666 ms. [Brian: Corrected-- was "exactly 3ms"] A value of 0 will produce zero output only, without no pulse created.
	</p><p>
		The number of available channels is normally (by default) 8.
        This can be reduced with the SC,8 command. The S2 RC
        servo output command cycles from channel 1 through channel
        <i>maximum_S2_channels</i> (normally 8), outputting any enabled
        channel's pulse from 0 ms to 3 ms. For a given channel, the
        repetition rate is determined by <i>maximum_S2_channels</i> *
        <i>S2_channel_duration_ms</i> which is normally 8 * 3 or 24 ms.
        Thus, each channel's output pulse will be repeated every 24 ms.
        However, if you change
        the <i>maximum_S2_channels</i> you will change the repetition
        rate of the pulses.  The <i>S2_channel_duration_ms</i> parameter can also be adjusted with the 
        SC,9 command.
	</p><p>        
    	<b>Slew rate:</b> 

        The <i>rate</i> argument is used to control how quickly the output changes
         from the current pulse width (servo position) to the new
        pulse width. If <i>rate</i> is zero, then the move is made on
        the next PWM cycle (i.e. the next time the pin is pulsed). If
        <i>rate</i> is nonzero, then the value of <i>rate</i> is added to (or
        subtracted from) the current pulse width each time the pulse is
        generated until the new target is reached. This means that the
        units of <i>rate</i> are 1/12,000th of a second per
        <i>maximum_S2_channels</i> * <i>S2_channel_duration_ms</i> or
        1/12,000th of a second per 24 ms.
 	</p><p>        
    	<b>Collisions with SP and TP:</b> 
   	 	The normal pen up/down servo control (SP and TP) commands
        internally use S2 channel 1. If you wish to to use SP and TP, then ignore
        channel 1 and start with channel 2. If you do not need the SP and TP
        commands, then you can use channels 1 through
        <i>maximum_S2_channels</i>.
 	</p><p>        
    	<b>Turn-on condition:</b>  
		 Note that the S2 command will always make <i>output_pin</i> an output
        before it starts outputting pulses to that pin.
  	</p><p>   
     	<b>Disabling S2 servo outputs:</b>  
		 The special command <code>S2,0&lt;CR&gt;</code> will turn off all RC servo support (freeing up CPU time, if that's important to you).
 	</p>    
      </li>

   	<li><span style="font-weight: bold;">Example:</span>  <code>S2,3,24000,6\r</code>
   	Use RP6 as a RC servo output, and set its on-time to 2 ms, and using channel 3 of the RC system, including a <i>rate</i> argument of 6.
   	<li><span style="font-weight: bold;">Example:</span>  <code>S2,0\r</code>
   	Turn off all RC servo support.
   	<li><span style="font-weight: bold;">Example:</span>  <code>S2,3,0\r</code> Turn off the output on whatever pin channel 3
        was assigned to.	
   	
	<li><span style="font-weight: bold;">Version History:</span> This version of the S2 command is only for firmware versions prior to v2.2.0 
	</li>
	</ul>



<hr class="short" />    



    <h4><a name="S2"></a> "S2"  &mdash; General RC Servo Output (v2.2.0 and newer)</h4>
 
  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>
	S2,<i>position</i>,<i>output_pin</i>[,<i>rate</i>[,<i>delay</i>]]&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Command:</span> <code>
	S2,0&lt;CR&gt;</code></li>
	
	
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Firmware versions:</span> Prior to v2.2.0 </li>
	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
		<li><i>position</i>, a number in the range 0 to 32,000. 
		<p />The "on time" of the signal, in units of
		1/12,000,000th of a second (about 83 &mu;s).
		</li>
		<li><i>output_pin</i>, a number in the range 0 to 24.
		<p />
		The physical RPx pin number to assign this channel to.<br>
		
		</li>
		<li>
			<i>rate</i> (optional), a number in the range 0 to 65535.
			<p />
			The rate at which to change to the new setting.
		</li>
		<li>
			<i>delay</i> (optional), a number in the range 0 to 65535.
			<p />
			Delay before next command, milliseconds.
		</li>
		</ul>

	</li>
	<li><span style="font-weight: bold;">Description:</span> 
	<p>
		This command allows
        you to control the RC servo output system on the EBB, to configures a generic RC servo output.
         
  	</p><p>   
	  	<b>Servo channels and time slices:</b> 
 
        Including the pen-lift servo, there are eight 
        software-defined RC
        servo 'channels', which have no physical meaning other than we
        can output up to 8 separate signals at once. 
        These channels are internally assigned as you use the S2 command
        to create additional servo outputs, up to a maximum of 8.
        
  	</p><p>   
        Many I/O
        pins on the MCU have RPx numbers (please refer to the schematic), and you can output
        RC servo pulses on up to 8 of these RPx pins.
          	</p><p>   
        The RC servo system will cycle through each of the 8
        channels. Each gets a 3 ms "slice" of time, thus giving a 24 ms repeat
        period for the full RC system.
 
  	</p><p>   
        
        If a given servo output is
        enabled, then at the beginning of its 3 ms time slot, it's RPx
        pin is set high. Then, <i>position</i> time later, the RPx pin
        is set low. This time is controlled by hardware (the
        ECCP2 in the CPU) so there is very little jitter in the pulse durations.
        <i>position</i> is in units of 1/12,000 of a second, so 32,000
        for <i>position</i> would be about 2.666 ms. [Brian: Corrected-- was "exactly 3ms"]. A value of 0 will produce zero output only, with no pulse created.
	</p><p>
		
		[ BRIAN: Added this paragraph back in, since it still appears to apply. Please check.]
		
		The number of available channels is normally (by default) 8.
        This can be reduced with the SC,8 command. The S2 RC
        servo output command cycles from channel 1 through channel
        <i>maximum_S2_channels</i> (normally 8), outputting any enabled
        channel's pulse from 0 ms to 3 ms. For a given channel, the
        repetition rate is determined by <i>maximum_S2_channels</i> *
        <i>S2_channel_duration_ms</i> which is normally 8 * 3 or 24 ms.
        Thus, each channel's output pulse will be repeated every 24 ms.
        However, if you change
        the <i>maximum_S2_channels</i> you will change the repetition
        rate of the pulses.   The <i>S2_channel_duration_ms</i> parameter can also be adjusted with the 
        SC,9 command.
  
	</p><p>        
    	<b>Delay:</b> The <i>delay</i> argument gives the number of milliseconds to delay the start of the next command. This is an optional argument that defaults to 0, giving no added delay.
    	[Brian: Does this mean that this command is added to the motion queue?]
        
        
	</p><p>        
    	<b>Slew rate:</b> 

        The <i>rate</i> argument is used to control how quickly the output changes
         from the current pulse width (servo position) to the new
        pulse width. If <i>rate</i> is zero, then the move is made on
        the next PWM cycle (i.e. the next time the pin is pulsed). If
        <i>rate</i> is nonzero, then the value of <i>rate</i> is added to (or
        subtracted from) the current pulse width each time the pulse is
        generated until the new target is reached. This means that the
        units of <i>rate</i> are 1/12,000th of a second per
        <i>maximum_S2_channels</i> * <i>S2_channel_duration_ms</i> or
        1/12,000th of a second per 24 ms.
 	</p><p>        
    	<b>Collisions with SP and TP:</b> 
   	 	The normal pen up/down servo control (SP and TP) commands
        internally use the S2 command to manage their actions through one of the software-defined channels. If desired, you can use the S2 command to 
        disable this channel, for example if you need access to all eight channels.
 	</p><p>        
    	<b>Turn-on condition:</b>  
		 Note that the S2 command will always make <i>output_pin</i> an output
        before it starts outputting pulses to that pin.
 	</p><p>        
    	<b>Disabling S2 servo outputs:</b>  
		 The special command <code>S2,0&lt;CR&gt;</code> will turn off all RC servo support (freeing up CPU time, if that's important to you).
 	</p>    
 	  </li>
 	  
  <li>RPx vs pin number table:<br>
        <table border="1" cellpadding="2" cellspacing="2">
          <tbody>
            <tr>
              <td valign="top"><b>RPx</b><b><br>
                </b></td>
              <td valign="top">RP0<br>
              </td>
              <td valign="top">RP1<br>
              </td>
              <td valign="top">RP2<br>
              </td>
              <td valign="top">RP3<br>
              </td>
              <td valign="top">RP4<br>
              </td>
              <td valign="top">RP5<br>
              </td>
              <td valign="top">RP6<br>
              </td>
              <td valign="top">RP7<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Pin</b><b><br>
                </b></td>
              <td valign="top">REF_RA0<br>
              </td>
              <td valign="top">RA1<br>
              </td>
              <td valign="top">RA5<br>
              </td>
              <td valign="top">RB0<br>
              </td>
              <td valign="top">RB1<br>
              </td>
              <td valign="top">RB2<br>
              </td>
              <td valign="top">RB3<br>
              </td>
              <td valign="top">RB4<br>
              </td>
            </tr>
          </tbody>
        </table>
        <table border="1" cellpadding="2" cellspacing="2" >
          <tbody>
            <tr>
              <td valign="top"><b>RPx</b><b><br>
                </b></td>
              <td valign="top">RP8<br>
              </td>
              <td valign="top">RP9<br>
              </td>
              <td valign="top">RP10<br>
              </td>
              <td valign="top">RP11<br>
              </td>
              <td valign="top">RP13<br>
              </td>
              <td valign="top">RP17<br>
              </td>
              <td valign="top">RP18<br>
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Pin</b><b><br>
                </b></td>
              <td valign="top">RB5<br>
              </td>
              <td valign="top">RB6<br>
              </td>
              <td valign="top">RB7<br>
              </td>
              <td valign="top">RC0<br>
              </td>
              <td valign="top">RC2<br>
              </td>
              <td valign="top">RC6<br>
              </td>
              <td valign="top">RC7<br>
              </td>
            </tr>
          </tbody>
        </table>
        <br>
      </li>

   	<li><span style="font-weight: bold;">Example:</span>  <code>S2,24000,6\r</code>
   	Use RP6 as a RC servo output, and set its on-time to 2 ms, including a <i>rate</i> argument of 6. (Recall that <i>rate</i> and <i>delay</i> are optional.)
   	<li><span style="font-weight: bold;">Example:</span>  <code>S2,0\r</code>
   	Turn off all RC servo support.
   	
   	<li><span style="font-weight: bold;">Example:</span>  <code>S2,0,5\r</code> Turn off the output on RP5 (which is pin RB2) so it stops sending any pulses.
 
    	<li><span style="font-weight: bold;">Example:</span>  <code>S2,10000,5\r</code> Send a 0.83 ms pulse out pin RB2. [ Brian- Corrected; please check.]
     	<li><span style="font-weight: bold;">Example:</span>  <code>S2,27500,5\r</code> Send a 2.3 ms pulse out pin RB2. 
 
   	
	<li><span style="font-weight: bold;">Version History:</span> This version of the S2 command is only for firmware versions v2.2.0 and newer
	</li>
	</ul>


  
<hr class="short" />    

    <h4><a name="TP"></a> "TP"  &mdash; Toggle Pen </h4>
 
  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>TP[,<i>duration</i>]&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9 and newer </li>

	<li><span style="font-weight: bold;">Arguments:</span>
	<ul>
        <li><i>duration</i>: (Optional) an integer in the range of 1 to 65535, giving an delay in milliseconds.
        
        </li>
        
	</ul>
	</li>
	
	
	</li>
	<li><span style="font-weight: bold;">Description:</span>
	<p> This command toggles the state of the pen (up-&gt;down and
          down-&gt;up). EBB firmware resets with pen in 'up'
          (<i>servo_min</i>) state.
	</p><p>
	  Note that conventionally, we have used the
        <i>servo_min</i> ("SC,4") value as the 'Pen up position', and
        the <i>servo_max</i> ("SC,5") value as the 'Pen down position'.
</p><p>
		The optional <i>duration</i> argument is in milliseconds. It represents the total length of time between
          when the pen move is started, and when the next command will
          be executed. Note that this is not related to
          how fast the pen moves, which is set with the <a href="#SC">SC</a> command. 
          Rather, it is an intentional delay of a given
          <i>duration</i>, to force the EBB not to execute
          the next command (often an <a href="#SM">SM</a>) for some length of time,
          which allows the pen move to complete
          and possibly some extra settling time before moving the other motors. 
</p><p>
		          If no <i>duration</i> argument is specified, a value of 0 milliseconds is used internally.
</p><p>	
		
    	<li><span style="font-weight: bold;">Version History:</span>
    	<ul>
	    	<li> Added in v1.9</li>
	    	<li> In versions prior to v2.2.1, the
        <i>duration</i> parameter had a bug and was in units of 40 &mu;s
        rather than 1 ms.</li>
    	</ul>
	</li>
	</ul>



<hr class="short" />    

       <h4><a name="QN"></a>"QN"  &mdash; Query node count</h4>
      
 	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>QN&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code><i>NodeCount</i>&lt;CR&gt;OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v1.9.2 and newer </li>
	<li><span style="font-weight: bold;">Description:</span> Query the value of the Node Counter.
	<p>
	This command asks the EBB what the current value of the Node
        Counter is. The Node Counter is an unsigned long int (8 bytes)
        value that gets incremented each time an "SM" command finishes
        executing. The Node Counter can be used to keep track of progress during
        various operations as needed.
 	<p>       
	The value of the node counter can also be manipulated with the following commands:
	<ul>
		<li>"SN"  &mdash; Set Node count</li>
		<li>"NI"  &mdash; Node count Increment</li>
		<li>"ND"  &mdash; Node count Decrement</li>
		<li>"CN"  &mdash; Clear node count [obsolete]</li>
	</ul></p></li>
     <li><span style="font-weight: bold;">Example Return Packet:</span>
    <code>1234567890&lt;CR&gt;</code> then </span>
    <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Version History:</span>  
		Added in v1.9.2</p></li>
	</ul>
     


<hr class="short" />    

    <h4><a name="XM"></a> "XM" &mdash; Stepper Move, for Mixed-axis Geometries</h4>

  	<ul>
	<li><span style="font-weight: bold;">Command:</span> <code>XM,<i>duration</i>,<i>axisA</i>,<i>axisB</i>&lt;CR&gt;</code></li>
	<li><span style="font-weight: bold;">Response:</span> <code>OK&lt;CR&gt;</code></li>

	<li><span style="font-weight: bold;">Firmware versions:</span> v2.3.0 and newer</li>
	<li><span style="font-weight: bold;">Arguments:</span> 
      <ul>
        <li><i>duration</i> is an integer in the range from 1 to 1677215, giving time in milliseconds.</li>
        <li><i>axisA</i> and <i>axisB</i> are integers, each in the range from -1677215 to 1677215, giving movement distances in steps.</li>
      </ul>

	<li><span style="font-weight: bold;">Description:</span> 
		<p>This command takes the <i>axisA</i> and <i>axisB</i> values,
        and creates a call to the <a href="#SM">SM</a> command with the SM command's
        <i>axis1</i> value as <i>axisA</i> + <i>axisB</i>, and
        <i>axis2</i> as <i>axisA</i> - <i>axisB</i>.
		</p><p>
		This command is designed to allow cleaner operation of
        machines like the <a
          href="http://www.multimechatronics.com/build_a_h-bot.php">H-Bot</a>
        and <a
          href="http://corexy.com">CoreXY</a>
        systems.<br>
		</p><p>	
		If both <i>axisA</i> and <i>axisB</i> are zero, then a
          delay of <i>duration</i> ms is executed.	
		</p><p>				
	The minimum speed at which the EBB can generate steps for each
        motor is 1.31 steps/second. The maximum speed is
        25 kSteps/second. If the XM command finds that this speed range
        will be violated on either axis, it will output an error message
        declaring such and it will not complete the move. Note that the
        range is checked on Axis1 and Axis2, NOT on AxisA and AxisB.
        (That is, the range is checked after performing the sum and difference.)		
		</p><p>				
Note that internally the EBB generates an ISR at the 25 kHz
        rate. Each time the ISR fires, the EBB determines if a step
        needs to be taken for a given axis or not. The practical result
        of this is that all steps will be 'quantized' to the 25 kHz
        (40 &mu;s) time intervals, and thus as the step rate gets close to
        25 kHz the 'correct' time between steps will not be generated,
        but instead each step will land on a 40 &mu;s tick in time. In
        almost all cases normally used by the EBB, this doesn't make any
        difference because the overall proper length for the entire move
        will be correct.			
		</p><p>	A value of 0 for <i>duration</i> is invalid and will be
        rejected. 
        </li>			
        
      	<li><span style="font-weight: bold;">Example:</span>
      	 <code>XM,1000,550,-1234\r</code> Move 550 steps in the A direction and -1234 steps in the B direction, in duration 1000 ms.</li>
      	 

	<li><span style="font-weight: bold;">Version History:</span>  
		Added in v2.3.0</p></li>
	</ul>




<p />
<br />
<p />



<p />
<hr>
<p />


<p />
<br />
<p />



    <H2><a name="faq"></a>Frequently Asked Questions</H2>

<p>
  <b>Q1)</b> How can I calculate how
    long it will take to move from one RC servo position to another?
    Specifically in relation to the standard pen-arm servo that is
    activated with the SP,1 and SP,0 commands.</p>
<p> <b>A1)</b>   
   By default, with
      the latest version of EBB firmware, we add (or subtract)
      the rate value from the current pulse duration every time the
      pulse fires until the current pulse duration equals the target
      duration. Normally we have 8 servo channels available, and each
      gets 3 ms, so that means that each channel can fire once every
      24 ms. So the rate value gets added or subtracted from the current
      pulse duration every 24ms.</p>
	 <p />     
	      For example, if you're currently at a position
        (pulse duration) of 10000 and you send a new command to move to
        position 15000, then you have a 'distance' of 5000 to go. So
        when we start out, our current duration is 10000 and our target
        is 15000. If our rate value is 100, then it will take 50 of
        these 24ms periods to get from 10000 to 15000, or 1.2 seconds
        total.
	 <p />     
	        
	        Now, when you're using the SP,0 and SP,1 commands,
        the servo_min (defaults to 16000, or 1.3 ms) and servo_max
        (defaults to 20000, or 1.6 ms) get used as the positions. And the
        servo_rate_up and servo_rate_down get used as the rates.
	        
	        So the formula is as follows:<p />
	        ((<i>servo_max</i> - <i>servo_min</i>) *
        .024)/<i>servo_rate</i> = total time to move
	        
	        	 <p />     
For the example above. ((15000 - 10000) * .024)/100 = 1.2 seconds.    
    

 <p />
<hr />
<p />

 
 
<div style="text-align: center;">	
	<a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" src="images/88x31.png" style="border: 0px solid ; width: 88px; height: 31px;"></a><p />
	</div>
	
  <span xmlns:dc="http://purl.org/dc/elements/1.1/" property="dc:title">EiBotBoard</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.schmalzhaus.com/EBB" property="cc:attributionName" rel="cc:attributionURL">Brian
Schmalz</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/">Creative
Commons Attribution 3.0 United States License</a>.
  Based on a work at <a xmlns:dc="http://purl.org/dc/elements/1.1/" href="http:///www.schmalzhaus.com/EBB" rel="dc:source">www.schmalzhaus.com/EBB</a>.
  Permissions beyond the scope of this license may be available at <a xmlns:cc="http://creativecommons.org/ns#" href="http://www.schmalzhaus.com/EBB" rel="cc:morePermissions">www.schmalzhaus.com/EBB</a>.
<p />
<hr>
<p /><p>Extended EggBot documentation available at: <a href="http://wiki.evilmadscientist.com/eggbot">http://wiki.evilmadscientist.com/eggbot</a></p>


      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/evil-mad">Evil Mad Scientist Laboratories</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
